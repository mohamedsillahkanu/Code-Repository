<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Code Repository</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0066cc 0%, #004499 50%, #ffffff 100%);
            min-height: 100vh;
            color: #333;
            padding: 0;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 2px solid #0066cc;
            padding: 25px 0;
            margin-bottom: 40px;
            box-shadow: 0 2px 10px rgba(0, 102, 204, 0.1);
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .logo-section {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 30px;
        }

        .logo-container {
            width: 140px;
            height: 90px;
            border: 2px solid #0066cc;
            border-radius: 12px;
            overflow: hidden;
            background: white;
            box-shadow: 0 4px 12px rgba(0, 102, 204, 0.15);
            transition: transform 0.3s ease;
        }

        .logo-container:hover {
            transform: translateY(-3px);
        }

        .logo-image {
            width: 100%;
            height: 100%;
            object-fit: contain;
            padding: 8px;
        }

        .title-section {
            text-align: center;
        }

        .main-title {
            font-size: 3em;
            color: #0066cc;
            font-weight: 700;
            margin-bottom: 15px;
            text-shadow: 0 2px 4px rgba(0, 102, 204, 0.3);
        }

        .subtitle {
            font-size: 1.4em;
            color: #004499;
            font-weight: 400;
        }

        .dashboard-container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 50px;
            box-shadow: 0 15px 40px rgba(0, 102, 204, 0.2);
            border: 1px solid rgba(0, 102, 204, 0.2);
        }

        /* Collapsible Tab Button */
        .tab-toggle-btn {
            background: linear-gradient(135deg, #004499, #0066cc);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            margin-bottom: 20px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 68, 153, 0.3);
            font-size: 1.1em;
            display: flex;
            align-items: center;
            gap: 10px;
            justify-content: center;
            width: 250px;
        }

        .tab-toggle-btn:hover {
            background: linear-gradient(135deg, #0066cc, #004499);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 102, 204, 0.4);
        }

        .tab-toggle-btn .arrow {
            font-size: 1.2em;
            transition: transform 0.3s ease;
        }

        .tab-toggle-btn.collapsed .arrow {
            transform: rotate(-90deg);
        }

        /* Tab Navigation */
        .tab-navigation {
            display: flex;
            flex-wrap: wrap;
            border-bottom: 3px solid #0066cc;
            margin-bottom: 40px;
            gap: 5px;
            max-height: 0;
            overflow: hidden;
            opacity: 0;
            transition: all 0.5s ease;
        }

        .tab-navigation.expanded {
            max-height: 200px;
            opacity: 1;
            margin-bottom: 40px;
        }

        .tab-button {
            background: rgba(0, 102, 204, 0.1);
            border: none;
            padding: 15px 25px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            color: #004499;
            border-radius: 10px 10px 0 0;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            margin-bottom: -3px;
            position: relative;
        }

        .tab-button:hover {
            background: rgba(0, 102, 204, 0.2);
            color: #0066cc;
        }

        .tab-button.active {
            background: #0066cc;
            color: white;
            border-bottom: 3px solid #0066cc;
            transform: translateY(3px);
        }

        /* Tab Content */
        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease-in;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Content Sections */
        .section-header {
            color: #0066cc;
            font-size: 2.2em;
            font-weight: 700;
            margin-bottom: 30px;
            text-align: center;
            padding: 20px;
            background: rgba(0, 102, 204, 0.1);
            border-radius: 15px;
            border-left: 5px solid #0066cc;
        }

        /* Collapsible Sections */
        .collapsible-section {
            margin-bottom: 30px;
            border: 2px solid rgba(0, 102, 204, 0.2);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 102, 204, 0.1);
        }

        .section-toggle {
            background: linear-gradient(135deg, #0066cc, #004499);
            color: white;
            border: none;
            padding: 20px;
            width: 100%;
            text-align: left;
            cursor: pointer;
            font-size: 1.3em;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .section-toggle:hover {
            background: linear-gradient(135deg, #004499, #0066cc);
        }

        .section-toggle::after {
            content: '‚ñº';
            font-size: 1.2em;
            transition: transform 0.3s ease;
        }

        .section-toggle.collapsed::after {
            transform: rotate(-90deg);
        }

        .section-content {
            background: rgba(255, 255, 255, 0.95);
            max-height: 0;
            overflow: hidden;
            transition: all 0.5s ease;
            padding: 0;
        }

        .section-content.expanded {
            max-height: none;
            padding: 20px;
        }

        .content-text {
            font-size: 1.1em;
            line-height: 1.6;
            color: #333;
            margin-bottom: 25px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 10px;
            border-left: 4px solid #0066cc;
        }

        /* Markdown Display Styling */
        .markdown-display {
            background: rgba(255, 255, 255, 0.95);
            border: 2px solid rgba(0, 102, 204, 0.2);
            border-radius: 15px;
            padding: 30px;
            margin: 20px 0;
            box-shadow: 0 8px 25px rgba(0, 102, 204, 0.15);
            overflow-y: auto;
            max-height: 800px;
        }

        .markdown-display h1, .markdown-display h2, .markdown-display h3 {
            color: #0066cc;
            margin-top: 25px;
            margin-bottom: 15px;
            border-bottom: 2px solid #0066cc;
            padding-bottom: 8px;
        }

        .markdown-display h1 {
            font-size: 2.2em;
        }

        .markdown-display h2 {
            font-size: 1.8em;
        }

        .markdown-display h3 {
            font-size: 1.5em;
        }

        .markdown-display p {
            line-height: 1.6;
            margin-bottom: 15px;
            color: #333;
        }

        .markdown-display pre {
            background: #1e293b;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
            overflow-x: auto;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 14px;
            line-height: 1.6;
        }

        .markdown-display code {
            background: #f1f5f9;
            color: #0066cc;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 0.9em;
        }

        .markdown-display pre code {
            background: transparent;
            color: inherit;
            padding: 0;
        }

        .markdown-display ul, .markdown-display ol {
            margin-left: 20px;
            margin-bottom: 15px;
        }

        .markdown-display li {
            margin-bottom: 8px;
            line-height: 1.6;
        }

        .markdown-display blockquote {
            border-left: 4px solid #0066cc;
            padding-left: 20px;
            margin: 15px 0;
            background: rgba(0, 102, 204, 0.05);
            padding: 15px 20px;
            border-radius: 0 8px 8px 0;
            font-style: italic;
            color: #004499;
        }

        /* File Input Styling */
        .file-input-section {
            background: rgba(0, 102, 204, 0.05);
            border: 2px dashed #0066cc;
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            margin: 20px 0;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .file-input-section:hover {
            background: rgba(0, 102, 204, 0.1);
            border-color: #004499;
        }

        .file-input-section input[type="file"] {
            display: none;
        }

        .file-input-label {
            color: #0066cc;
            font-size: 1.2em;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }

        .file-icon {
            font-size: 3em;
            opacity: 0.7;
        }

        /* Result Image Section */
        .result-image-section {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .result-image-frame {
            width: 100%;
            max-width: 1000px;
            min-height: 500px;
            border: 3px solid #10b981;
            border-radius: 20px;
            overflow: hidden;
            background: linear-gradient(145deg, #ffffff, #f0fff4);
            box-shadow: 
                0 20px 40px rgba(16, 185, 129, 0.15),
                inset 0 2px 4px rgba(255, 255, 255, 0.9),
                inset 0 -2px 4px rgba(16, 185, 129, 0.1);
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .result-image-frame:hover {
            transform: translateY(-5px);
            box-shadow: 
                0 25px 50px rgba(16, 185, 129, 0.2),
                inset 0 2px 4px rgba(255, 255, 255, 0.9),
                inset 0 -2px 4px rgba(16, 185, 129, 0.1);
        }

        .result-image-placeholder {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 500px;
            text-align: center;
            padding: 40px;
            color: #10b981;
            border: 2px dashed #10b981;
            border-radius: 15px;
            margin: 10px;
            background: rgba(255, 255, 255, 0.5);
            transition: all 0.3s ease;
        }

        .result-image-placeholder:hover {
            background: rgba(16, 185, 129, 0.05);
            border-color: #059669;
        }

        .uploaded-result-image {
            width: 100%;
            height: auto;
            max-height: 90vh;
            display: block;
            object-fit: contain;
            border-radius: 15px;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.2);
        }

        .placeholder-icon {
            font-size: 4em;
            margin-bottom: 20px;
            opacity: 0.7;
        }

        .placeholder-text {
            font-size: 1.3em;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .placeholder-subtext {
            font-size: 1em;
            opacity: 0.7;
            font-style: italic;
        }

        @media (max-width: 768px) {
            .main-title {
                font-size: 2.2em;
            }
            
            .subtitle {
                font-size: 1.2em;
            }
            
            .logo-section {
                justify-content: center;
            }
            
            .logo-container {
                width: 120px;
                height: 80px;
            }
            
            .dashboard-container {
                padding: 30px;
            }

            .tab-navigation {
                flex-direction: column;
            }

            .tab-button {
                border-radius: 10px;
                margin-bottom: 5px;
                padding: 12px 20px;
                font-size: 0.9em;
            }

            .tab-button.active {
                transform: none;
            }

            .tab-toggle-btn {
                width: 200px;
                padding: 12px 20px;
                font-size: 1em;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <!-- Logo Section for 4 logos -->
            <div class="logo-section">
                <div class="logo-container">
                    <img src="NMCP.png" alt="NMCP Logo" class="logo-image">
                </div>
                
                <div class="logo-container">
                    <img src="WHO.png" alt="WHO Logo" class="logo-image">
                </div>
                
                <div class="logo-container">
                    <img src="CHAI2.png" alt="CHAI Logo" class="logo-image">
                </div>

                <div class="logo-container">
                    <img src="ICF-SL.jpg" alt="ICF-SL Logo" class="logo-image">
                </div>
            </div>
            
            <!-- Title Section -->
            <div class="title-section">
                <h1 class="main-title">Code Repository</h1>
                <h2 class="subtitle">Code Repository and Analysis System</h2>
                <h3 class="subtitle">by</h3>
                <h2 class="subtitle">Informatics Consultancy Firm Sierra Leone (ICF-SL)</h2>
                <h2 class="subtitle"><em>A local firm with international standards</em></h2>
            </div>
        </div>
    </div>

    <div class="dashboard-container">
        <!-- Tab Toggle Button -->
        <button class="tab-toggle-btn collapsed" onclick="toggleTabs()" id="tabToggleBtn">
            <span>üìÇ</span>
            <span>Show Navigation Menu</span>
            <span class="arrow">‚ñº</span>
        </button>

        <!-- Tab Navigation -->
        <div class="tab-navigation" id="tabNavigation">
            <button class="tab-button active" onclick="openTab(event, 'overview')">Overview</button>
            <button class="tab-button" onclick="openTab(event, 'tab2')">Malaria Analysis Code</button>
            <button class="tab-button" onclick="openTab(event, 'tab3')">Data Visualization</button>
            <button class="tab-button" onclick="openTab(event, 'tab4')">Reports & Export</button>
        </div>

        <!-- Tab Contents -->
        <div id="overview" class="tab-content active">
            <div class="section-header">Code Repository</div>
            
            <!-- Code Repository Introduction -->
            <div class="collapsible-section">
                <button class="section-toggle collapsed" onclick="toggleSection(this)">
                    üíª Code Repository Overview
                </button>
                <div class="section-content">
                    <div class="content-text">
                        <strong>Malaria Data Analysis Code Repository</strong><br>
                        This system provides a comprehensive collection of Python scripts and analysis tools designed specifically for the National Malaria Control Programme (NMCP) in Sierra Leone. 
                        The code repository contains standardized functions for processing malaria surveillance data, calculating key indicators, and generating analytical reports that support evidence-based decision making.
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab 2 -->
        <div id="tab2" class="tab-content">
            <div class="section-header">Malaria Data Analysis Code</div>
            
            <!-- File Upload Section -->
            <div class="collapsible-section">
                <button class="section-toggle" onclick="toggleSection(this)">
                    üìÅ Load Malaria Analysis Code (Markdown)
                </button>
                <div class="section-content expanded">
                    <div class="file-input-section" onclick="document.getElementById('markdownFileInput').click();">
                        <input type="file" id="markdownFileInput" accept=".md,.txt" onchange="loadMarkdownFile(event)">
                        <label class="file-input-label">
                            <div class="file-icon">üìÑ</div>
                            <div>Click to upload malaria_analysis.md file</div>
                            <div style="font-size: 0.9em; opacity: 0.7;">Supports .md and .txt files</div>
                        </label>
                    </div>
                    
                    <!-- Auto-load default markdown if no file is selected -->
                    <div class="markdown-display" id="markdownDisplay">
                        <!-- Default content will be loaded here -->
                    </div>
                </div>
            </div>

            <!-- Sample Output Results -->
            <div class="collapsible-section">
                <button class="section-toggle collapsed" onclick="toggleSection(this)">
                    üìä Sample Output Results
                </button>
                <div class="section-content">
                    <div class="result-image-section">
                        <div class="result-image-frame">
                            <input type="file" id="resultImageUpload" accept="image/*" onchange="displayResultImage(event)" style="display: none;">
                            <div class="result-image-placeholder" id="resultImagePlaceholder" onclick="document.getElementById('resultImageUpload').click();">
                                <div class="placeholder-icon">üìä</div>
                                <div class="placeholder-text">Click to upload results.png</div>
                                <div class="placeholder-subtext">Upload your analysis output image</div>
                            </div>
                            <img id="uploadedResultImage" class="uploaded-result-image" style="display: none;" onclick="document.getElementById('resultImageUpload').click();">
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab 3 -->
        <div id="tab3" class="tab-content">
            <div class="section-header">Data Visualization</div>
            <div class="content-text">
                This tab will contain data visualization tools and charts for malaria analysis.
            </div>
        </div>

        <!-- Tab 4 -->
        <div id="tab4" class="tab-content">
            <div class="section-header">Reports & Export</div>
            <div class="content-text">
                This tab will contain report generation and data export functionality.
            </div>
        </div>
    </div>

    <script>
        // Default markdown content
        const defaultMarkdownContent = `# Malaria Data Analysis Code

## Overview
This repository contains Python code for analyzing malaria confirmation data across districts and time periods for the National Malaria Control Programme (NMCP) in Sierra Leone.

## Step 1: Import Required Libraries

\`\`\`python
# Import necessary libraries
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns
from datetime import datetime
\`\`\`

## Step 2: Define Main Analysis Function

\`\`\`python
def analyze_malaria_confirmation(data_file):
    """
    Analyze malaria confirmation rates across districts and time periods
    
    Parameters:
    data_file (str): Path to the malaria data CSV file
    
    Returns:
    dict: Analysis results including trends and statistics
    """
\`\`\`

## Step 3: Load and Process Data

\`\`\`python
    # Load the dataset
    df = pd.read_csv(data_file)
    
    # Convert date column to datetime
    df['date'] = pd.to_datetime(df['date'])
    
    # Calculate confirmation rate
    df['confirmation_rate'] = (df['confirmed_cases'] / df['tested_cases']) * 100
\`\`\`

## Step 4: Calculate District Statistics

\`\`\`python
    # Group by district and calculate statistics
    district_stats = df.groupby('district').agg({
        'confirmation_rate': ['mean', 'std', 'min', 'max'],
        'confirmed_cases': 'sum',
        'tested_cases': 'sum'
    })
\`\`\`

## Step 5: Monthly Trend Analysis

\`\`\`python
    # Calculate trend analysis
    monthly_trends = df.groupby([pd.Grouper(key='date', freq='M'), 'district'])['confirmation_rate'].mean().reset_index()
\`\`\`

## Step 6: Return Analysis Results

\`\`\`python
    return {
        'district_statistics': district_stats,
        'monthly_trends': monthly_trends,
        'overall_rate': df['confirmation_rate'].mean()
    }

# Example usage
results = analyze_malaria_confirmation('malaria_data_2024.csv')
print(f"Overall confirmation rate: {results['overall_rate']:.2f}%")
\`\`\`

## Additional Analysis Functions

### Generate Summary Report

\`\`\`python
def generate_summary_report(results):
    """
    Generate a summary report from analysis results
    """
    report = []
    report.append("=== MALARIA CONFIRMATION ANALYSIS REPORT ===\\n")
    report.append(f"Overall Confirmation Rate: {results['overall_rate']:.2f}%\\n")
    report.append("District Statistics:")
    report.append(results['district_statistics'].to_string())
    
    return "\\n".join(report)
\`\`\`

### Create Visualizations

\`\`\`python
def create_visualizations(results):
    """
    Create visualizations for the analysis results
    """
    # Set up the plotting style
    plt.style.use('seaborn-v0_8')
    fig, axes = plt.subplots(2, 2, figsize=(15, 10))
    
    # District confirmation rates
    district_means = results['district_statistics']['confirmation_rate']['mean']
    axes[0,0].bar(district_means.index, district_means.values)
    axes[0,0].set_title('Average Confirmation Rate by District')
    axes[0,0].set_ylabel('Confirmation Rate (%)')
    axes[0,0].tick_params(axis='x', rotation=45)
    
    # Monthly trends
    monthly_data = results['monthly_trends']
    for district in monthly_data['district'].unique():
        district_data = monthly_data[monthly_data['district'] == district]
        axes[0,1].plot(district_data['date'], district_data['confirmation_rate'], 
                      marker='o', label=district)
    
    axes[0,1].set_title('Monthly Confirmation Rate Trends')
    axes[0,1].set_ylabel('Confirmation Rate (%)')
    axes[0,1].legend()
    axes[0,1].tick_params(axis='x', rotation=45)
    
    plt.tight_layout()
    plt.savefig('malaria_analysis_results.png', dpi=300, bbox_inches='tight')
    plt.show()
\`\`\`

## Usage Instructions

1. **Prepare your data**: Ensure your CSV file contains columns for 'date', 'district', 'confirmed_cases', and 'tested_cases'
2. **Run the analysis**: Call \`analyze_malaria_confirmation('your_data.csv')\`
3. **Generate reports**: Use \`generate_summary_report(results)\` for text output
4. **Create visualizations**: Use \`create_visualizations(results)\` for charts

## Data Requirements

Your CSV file should have the following structure:

| date | district | confirmed_cases | tested_cases |
|------|----------|----------------|--------------|
| 2024-01-01 | Freetown | 45 | 120 |
| 2024-01-01 | Bo | 23 | 89 |
| ... | ... | ... | ... |

## Output Interpretation

- **Overall Rate**: Average confirmation rate across all districts and time periods
- **District Statistics**: Mean, standard deviation, minimum, and maximum confirmation rates for each district
- **Monthly Trends**: Time series data showing how confirmation rates change over time by district

---

*This code is developed by ICF-SL for the National Malaria Control Programme (NMCP) Sierra Leone*`;

        function openTab(evt, tabName) {
            // Hide all tab contents
            var tabcontents = document.getElementsByClassName("tab-content");
            for (var i = 0; i < tabcontents.length; i++) {
                tabcontents[i].classList.remove("active");
            }
            
            // Remove active class from all tab buttons
            var tabbuttons = document.getElementsByClassName("tab-button");
            for (var i = 0; i < tabbuttons.length; i++) {
                tabbuttons[i].classList.remove("active");
            }
            
            // Show the selected tab content and mark button as active
            var targetTab = document.getElementById(tabName);
            if (targetTab) {
                targetTab.classList.add("active");
            }
            if (evt && evt.currentTarget) {
                evt.currentTarget.classList.add("active");
            }
            
            // Auto-collapse navigation after tab selection
            var tabNav = document.getElementById("tabNavigation");
            var toggleBtn = document.getElementById("tabToggleBtn");
            if (tabNav && toggleBtn) {
                tabNav.classList.remove("expanded");
                toggleBtn.classList.add("collapsed");
                toggleBtn.innerHTML = '<span>üìÇ</span><span>Show Navigation Menu</span><span class="arrow">‚ñº</span>';
            }
        }

        function toggleTabs() {
            var tabNav = document.getElementById("tabNavigation");
            var toggleBtn = document.getElementById("tabToggleBtn");
            
            if (tabNav && toggleBtn) {
                if (tabNav.classList.contains("expanded")) {
                    // Collapse the menu
                    tabNav.classList.remove("expanded");
                    toggleBtn.classList.add("collapsed");
                    toggleBtn.innerHTML = '<span>üìÇ</span><span>Show Navigation Menu</span><span class="arrow">‚ñº</span>';
                } else {
                    // Expand the menu
                    tabNav.classList.add("expanded");
                    toggleBtn.classList.remove("collapsed");
                    toggleBtn.innerHTML = '<span>üìÇ</span><span>Hide Navigation Menu</span><span class="arrow">‚ñº</span>';
                }
            }
        }

        function toggleSection(button) {
            if (!button || !button.nextElementSibling) return;
            
            var content = button.nextElementSibling;
            var isCollapsed = content.classList.contains("expanded");
            
            if (isCollapsed) {
                content.classList.remove("expanded");
                button.classList.add("collapsed");
            } else {
                content.classList.add("expanded");
                button.classList.remove("collapsed");
            }
        }

        function loadMarkdownFile(event) {
            const file = event.target.files[0];
            if (file && (file.type === 'text/markdown' || file.type === 'text/plain' || file.name.endsWith('.md'))) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const markdownContent = e.target.result;
                    renderMarkdown(markdownContent);
                };
                reader.readAsText(file);
            } else {
                alert('Please select a valid markdown (.md) or text (.txt) file.');
            }
        }

        function renderMarkdown(markdownText) {
            const display = document.getElementById('markdownDisplay');
            if (!display) return;
            
            // Simple markdown to HTML conversion
            let html = markdownText
                // Headers
                .replace(/^### (.*$)/gim, '<h3>$1</h3>')
                .replace(/^## (.*$)/gim, '<h2>$1</h2>')
                .replace(/^# (.*$)/gim, '<h1>$1</h1>')
                // Code blocks
                .replace(/```(\w+)?\n([\s\S]*?)```/g, '<pre><code>$2</code></pre>')
                // Inline code
                .replace(/`([^`]+)`/g, '<code>$1</code>')
                // Bold
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                // Italic
                .replace(/\*(.*?)\*/g, '<em>$1</em>')
                // Line breaks
                .replace(/\n\n/g, '</p><p>')
                .replace(/\n/g, '<br>')
                // Tables (basic support)
                .replace(/\|(.+)\|/g, function(match, content) {
                    const cells = content.split('|').map(cell => cell.trim());
                    return '<tr>' + cells.map(cell => `<td>${cell}</td>`).join('') + '</tr>';
                });
            
            // Wrap paragraphs
            html = '<p>' + html + '</p>';
            
            display.innerHTML = html;
        }

        function displayResultImage(event) {
            const file = event.target.files[0];
            if (file && file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const placeholder = document.getElementById('resultImagePlaceholder');
                    const uploadedImage = document.getElementById('uploadedResultImage');
                    
                    if (placeholder && uploadedImage) {
                        // Hide placeholder and show image
                        placeholder.style.display = 'none';
                        uploadedImage.src = e.target.result;
                        uploadedImage.style.display = 'block';
                        
                        // Optional: Add click handler to uploaded image to change it
                        uploadedImage.onclick = function() {
                            const upload = document.getElementById('resultImageUpload');
                            if (upload) upload.click();
                        };
                    }
                };
                reader.readAsDataURL(file);
            }
        }

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            // Set navigation as collapsed by default
            var tabNav = document.getElementById("tabNavigation");
            var toggleBtn = document.getElementById("tabToggleBtn");
            
            if (tabNav && toggleBtn) {
                tabNav.classList.remove("expanded");
                toggleBtn.classList.add("collapsed");
            }
            
            // Initialize all content sections as collapsed by default except the markdown section
            var sections = document.querySelectorAll('.section-content');
            var buttons = document.querySelectorAll('.section-toggle');
            
            sections.forEach(function(section, index) {
                if (section && section.closest('#tab2') && index === 0) {
                    // Keep the first section in tab2 (markdown section) expanded
                    section.classList.add('expanded');
                } else if (section) {
                    section.classList.remove('expanded');
                }
            });
            
            buttons.forEach(function(button, index) {
                if (button && button.closest('#tab2') && index === 0) {
                    // Keep the first button in tab2 not collapsed
                    button.classList.remove('collapsed');
                } else if (button) {
                    button.classList.add('collapsed');
                }
            });
            
            // Load default markdown content
            renderMarkdown(defaultMarkdownContent);
        });
    </script>
</body>
</html>
