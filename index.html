<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Code Repository</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0066cc 0%, #004499 50%, #ffffff 100%);
            min-height: 100vh;
            color: #333;
            padding: 0;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 2px solid #0066cc;
            padding: 25px 0;
            margin-bottom: 40px;
            box-shadow: 0 2px 10px rgba(0, 102, 204, 0.1);
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .logo-section {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 30px;
        }

        .logo-container {
            width: 140px;
            height: 90px;
            border: 2px solid #0066cc;
            border-radius: 12px;
            overflow: hidden;
            background: white;
            box-shadow: 0 4px 12px rgba(0, 102, 204, 0.15);
            transition: transform 0.3s ease;
        }

        .logo-container:hover {
            transform: translateY(-3px);
        }

        .logo-image {
            width: 100%;
            height: 100%;
            object-fit: contain;
            padding: 8px;
        }

        .title-section {
            text-align: center;
        }

        .main-title {
            font-size: 3em;
            color: #0066cc;
            font-weight: 700;
            margin-bottom: 15px;
            text-shadow: 0 2px 4px rgba(0, 102, 204, 0.3);
        }

        .subtitle {
            font-size: 1.4em;
            color: #004499;
            font-weight: 400;
        }

        .dashboard-container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 50px;
            box-shadow: 0 15px 40px rgba(0, 102, 204, 0.2);
            border: 1px solid rgba(0, 102, 204, 0.2);
        }

        /* Tab Toggle Button */
        .tab-toggle-btn {
            background: linear-gradient(135deg, #004499, #0066cc);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            margin-bottom: 20px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 68, 153, 0.3);
            font-size: 1.1em;
            display: flex;
            align-items: center;
            gap: 10px;
            justify-content: center;
            width: 250px;
        }

        .tab-toggle-btn:hover {
            background: linear-gradient(135deg, #0066cc, #004499);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 102, 204, 0.4);
        }

        .tab-toggle-btn .arrow {
            font-size: 1.2em;
            transition: transform 0.3s ease;
        }

        .tab-toggle-btn.collapsed .arrow {
            transform: rotate(-90deg);
        }

        /* Tab Navigation */
        .tab-navigation {
            display: flex;
            flex-wrap: wrap;
            border-bottom: 3px solid #0066cc;
            margin-bottom: 40px;
            gap: 5px;
            max-height: 0;
            overflow: hidden;
            opacity: 0;
            transition: all 0.5s ease;
        }

        .tab-navigation.expanded {
            max-height: 200px;
            opacity: 1;
            margin-bottom: 40px;
        }

        .tab-button {
            background: rgba(0, 102, 204, 0.1);
            border: none;
            padding: 15px 25px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            color: #004499;
            border-radius: 10px 10px 0 0;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            margin-bottom: -3px;
            position: relative;
        }

        .tab-button:hover {
            background: rgba(0, 102, 204, 0.2);
            color: #0066cc;
        }

        .tab-button.active {
            background: #0066cc;
            color: white;
            border-bottom: 3px solid #0066cc;
            transform: translateY(3px);
        }

        /* Tab Content */
        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease-in;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Content Sections */
        .section-header {
            color: #0066cc;
            font-size: 2.2em;
            font-weight: 700;
            margin-bottom: 30px;
            text-align: center;
            padding: 20px;
            background: rgba(0, 102, 204, 0.1);
            border-radius: 15px;
            border-left: 5px solid #0066cc;
        }

        /* Markdown Upload Section */
        .markdown-upload-section {
            margin-bottom: 30px;
            border: 2px solid rgba(0, 102, 204, 0.2);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 102, 204, 0.1);
        }

        .upload-header {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            padding: 20px;
            font-size: 1.3em;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .upload-area {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            text-align: center;
            border: 2px dashed #10b981;
            margin: 20px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .upload-area:hover {
            background: rgba(16, 185, 129, 0.05);
            border-color: #059669;
        }

        .upload-area.dragover {
            background: rgba(16, 185, 129, 0.1);
            border-color: #059669;
            transform: scale(1.02);
        }

        .upload-icon {
            font-size: 3em;
            color: #10b981;
            margin-bottom: 15px;
        }

        .upload-text {
            font-size: 1.2em;
            color: #10b981;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .upload-subtext {
            color: #6b7280;
            font-size: 0.9em;
        }

        /* Collapsible Sections */
        .collapsible-section {
            margin-bottom: 30px;
            border: 2px solid rgba(0, 102, 204, 0.2);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 102, 204, 0.1);
        }

        .section-toggle {
            background: linear-gradient(135deg, #0066cc, #004499);
            color: white;
            border: none;
            padding: 20px;
            width: 100%;
            text-align: left;
            cursor: pointer;
            font-size: 1.3em;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .section-toggle:hover {
            background: linear-gradient(135deg, #004499, #0066cc);
        }

        .section-toggle::after {
            content: '▼';
            font-size: 1.2em;
            transition: transform 0.3s ease;
        }

        .section-toggle.collapsed::after {
            transform: rotate(-90deg);
        }

        .section-content {
            background: rgba(255, 255, 255, 0.95);
            max-height: 0;
            overflow: hidden;
            transition: all 0.5s ease;
            padding: 0;
        }

        .section-content.expanded {
            max-height: none;
            padding: 20px;
        }

        /* Markdown Content Styling */
        .markdown-content {
            background: #1a1a1a;
            border-radius: 15px;
            padding: 25px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 14px;
            line-height: 1.6;
            color: #e5e7eb;
            overflow-x: auto;
            border: 2px solid rgba(59, 130, 246, 0.3);
            box-shadow: 0 10px 30px rgba(59, 130, 246, 0.1);
        }

        /* Enhanced Syntax Highlighting */
        .md-keyword {
            color: #c792ea;
            font-weight: 600;
        }

        .md-function {
            color: #82aaff;
            font-weight: 600;
        }

        .md-string {
            color: #c3e88d;
        }

        .md-comment {
            color: #546e7a;
            font-style: italic;
        }

        .md-variable {
            color: #ffcb6b;
        }

        .md-number {
            color: #f78c6c;
        }

        .md-operator {
            color: #89ddff;
        }

        .md-class {
            color: #ffcb6b;
            font-weight: 600;
        }

        .md-import {
            color: #c792ea;
            font-weight: 600;
        }

        .md-decorator {
            color: #ff9cac;
        }

        .md-header {
            color: #82aaff;
            font-weight: bold;
            font-size: 1.2em;
            margin: 20px 0 10px 0;
        }

        .md-bold {
            color: #ffffff;
            font-weight: bold;
        }

        .md-italic {
            color: #b2ccd6;
            font-style: italic;
        }

        .md-code-inline {
            background: rgba(255, 255, 255, 0.1);
            color: #c3e88d;
            padding: 2px 6px;
            border-radius: 4px;
        }

        /* Code Section Styling */
        .code-section {
            margin: 30px 0;
            border: 2px solid rgba(59, 130, 246, 0.3);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(59, 130, 246, 0.1);
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
        }

        .code-header {
            background: linear-gradient(135deg, #3b82f6, #1e40af);
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .code-title {
            font-weight: 600;
            font-size: 1.1em;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .copy-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .copy-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .copy-btn.copied {
            background: #10b981;
            border-color: #10b981;
        }

        .code-container {
            background: #1e293b;
            padding: 0;
            position: relative;
            overflow-x: auto;
        }

        .code-content {
            padding: 25px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 14px;
            line-height: 1.6;
            color: #e2e8f0;
            white-space: pre;
            overflow-x: auto;
        }

        /* Enhanced Python Syntax highlighting */
        .keyword {
            color: #c792ea;
            font-weight: 600;
        }

        .function {
            color: #82aaff;
            font-weight: 600;
        }

        .string {
            color: #c3e88d;
        }

        .comment {
            color: #546e7a;
            font-style: italic;
        }

        .variable {
            color: #ffcb6b;
        }

        .number {
            color: #f78c6c;
        }

        .operator {
            color: #89ddff;
        }

        .class {
            color: #ffcb6b;
            font-weight: 600;
        }

        .import {
            color: #c792ea;
            font-weight: 600;
        }

        .decorator {
            color: #ff9cac;
        }

        .content-text {
            font-size: 1.1em;
            line-height: 1.6;
            color: #333;
            margin-bottom: 25px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 10px;
            border-left: 4px solid #0066cc;
        }

        /* Step Description */
        .step-description {
            background: rgba(0, 102, 204, 0.05);
            border-left: 4px solid #0066cc;
            padding: 15px 20px;
            margin-bottom: 20px;
            border-radius: 0 10px 10px 0;
            color: #004499;
            font-size: 1em;
            line-height: 1.5;
            font-weight: 500;
        }

        /* Result Image Section */
        .result-image-section {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .result-image-frame {
            width: 100%;
            max-width: 1000px;
            min-height: 500px;
            border: 3px solid #10b981;
            border-radius: 20px;
            overflow: hidden;
            background: linear-gradient(145deg, #ffffff, #f0fff4);
            box-shadow: 
                0 20px 40px rgba(16, 185, 129, 0.15),
                inset 0 2px 4px rgba(255, 255, 255, 0.9),
                inset 0 -2px 4px rgba(16, 185, 129, 0.1);
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .result-image-frame:hover {
            transform: translateY(-5px);
            box-shadow: 
                0 25px 50px rgba(16, 185, 129, 0.2),
                inset 0 2px 4px rgba(255, 255, 255, 0.9),
                inset 0 -2px 4px rgba(16, 185, 129, 0.1);
        }

        .result-image-placeholder {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 500px;
            text-align: center;
            padding: 40px;
            color: #10b981;
            border: 2px dashed #10b981;
            border-radius: 15px;
            margin: 10px;
            background: rgba(255, 255, 255, 0.5);
            transition: all 0.3s ease;
        }

        .result-image-placeholder:hover {
            background: rgba(16, 185, 129, 0.05);
            border-color: #059669;
        }

        .uploaded-result-image {
            width: 100%;
            height: auto;
            max-height: 90vh;
            display: block;
            object-fit: contain;
            border-radius: 15px;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.2);
        }

        .placeholder-icon {
            font-size: 4em;
            margin-bottom: 20px;
            opacity: 0.7;
        }

        .placeholder-text {
            font-size: 1.3em;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .placeholder-subtext {
            font-size: 1em;
            opacity: 0.7;
            font-style: italic;
        }

        @media (max-width: 768px) {
            .main-title {
                font-size: 2.2em;
            }
            
            .subtitle {
                font-size: 1.2em;
            }
            
            .logo-section {
                justify-content: center;
            }
            
            .logo-container {
                width: 120px;
                height: 80px;
            }
            
            .dashboard-container {
                padding: 30px;
            }

            .tab-navigation {
                flex-direction: column;
            }

            .tab-button {
                border-radius: 10px;
                margin-bottom: 5px;
                padding: 12px 20px;
                font-size: 0.9em;
            }

            .tab-button.active {
                transform: none;
            }

            .tab-toggle-btn {
                width: 200px;
                padding: 12px 20px;
                font-size: 1em;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <!-- Logo Section for 4 logos -->
            <div class="logo-section">
                <div class="logo-container">
                    <img src="NMCP.png" alt="NMCP Logo" class="logo-image">
                </div>
                
                <div class="logo-container">
                    <img src="WHO.png" alt="WHO Logo" class="logo-image">
                </div>
                
                <div class="logo-container">
                    <img src="CHAI2.png" alt="CHAI Logo" class="logo-image">
                </div>

                <div class="logo-container">
                    <img src="ICF-SL.jpg" alt="ICF-SL Logo" class="logo-image">
                </div>
            </div>
            
            <!-- Title Section -->
            <div class="title-section">
                <h1 class="main-title">Malaria Program Review (MPR)</h1>
                <h2 class="subtitle">Enhanced Code Repository and Analysis System</h2>
                <h3 class="subtitle">by</h3>
                <h2 class="subtitle">Informatics Consultancy Firm Sierra Leone (ICF-SL)</h2>
                <h2 class="subtitle"><em>A local firm with international standards</em></h2>
            </div>
        </div>
    </div>

    <div class="dashboard-container">
        <!-- Tab Toggle Button -->
        <button class="tab-toggle-btn collapsed" onclick="toggleTabs()" id="tabToggleBtn">
            <span>📂</span>
            <span>Show Navigation Menu</span>
            <span class="arrow">▼</span>
        </button>

        <!-- Tab Navigation -->
        <div class="tab-navigation" id="tabNavigation">
            <button class="tab-button active" onclick="openTab(event, 'overview')">Overview</button>
            <button class="tab-button" onclick="openTab(event, 'tab2')">Malaria Analysis Code</button>
            <button class="tab-button" onclick="openTab(event, 'tab3')">Markdown Viewer</button>
            <button class="tab-button" onclick="openTab(event, 'tab4')">Data Visualization</button>
            <button class="tab-button" onclick="openTab(event, 'tab5')">Reports & Export</button>
        </div>

        <!-- Tab Contents -->
        <div id="overview" class="tab-content active">
            <div class="section-header">Enhanced Code Repository</div>
            
            <!-- Code Repository Introduction -->
            <div class="collapsible-section">
                <button class="section-toggle collapsed" onclick="toggleSection(this)">
                    💻 Enhanced Code Repository Overview
                </button>
                <div class="section-content">
                    <div class="content-text">
                        <strong>Enhanced Malaria Data Analysis Code Repository</strong><br>
                        This system provides a comprehensive collection of Python scripts and analysis tools designed specifically for the National Malaria Control Programme (NMCP) in Sierra Leone. 
                        The enhanced repository now includes:
                        <br><br>
                        • <strong>Markdown File Support:</strong> Upload and view .md files with full syntax highlighting<br>
                        • <strong>Enhanced Code Display:</strong> Improved syntax highlighting for Python, R, SQL, and other languages<br>
                        • <strong>Collapsible Sections:</strong> Organized content with expandable sections for better navigation<br>
                        • <strong>Interactive Features:</strong> Copy code functionality, drag-and-drop file uploads<br>
                        • <strong>Professional Styling:</strong> Dark theme code blocks with proper color coding
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab 2 -->
        <div id="tab2" class="tab-content">
            <div class="section-header">Malaria Analysis Code</div>
            
            <!-- Dynamic Content from Markdown Files -->
            <div class="collapsible-section">
                <button class="section-toggle collapsed" onclick="toggleSection(this)">
                    📋 Code Repository Instructions
                </button>
                <div class="section-content">
                    <div class="step-description">
                        Upload or specify markdown files (.md) containing your analysis code and documentation. All content will be dynamically loaded from your files.
                    </div>
                    
                    <!-- Code File Reader -->
                    <div style="margin: 20px 0; padding: 20px; background: linear-gradient(135deg, #f0f8ff, #e0f2fe); border-radius: 10px; border-left: 5px solid #0066cc;">
                        <h4 style="color: #0066cc; margin-bottom: 15px;">📂 Load Code Documentation</h4>
                        <div style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
                            <input type="text" id="codeFilename" placeholder="Enter code file (e.g., malaria_code.md)" 
                                   style="padding: 10px 15px; border: 2px solid #0066cc; border-radius: 6px; font-size: 14px; min-width: 280px; background: white; color: #333;"
                                   oninput="autoReadCodeFile()">
                            <button onclick="readCodeFile()" 
                                    style="padding: 10px 20px; background: linear-gradient(135deg, #0066cc, #004499); color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer;">
                                📖 Load Code
                            </button>
                        </div>
                    </div>
                    
                    <!-- Dynamic Code Content Display -->
                    <div id="codeContentContainer">
                        <!-- Code content from markdown files will be displayed here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab 3 - NEW MARKDOWN VIEWER -->
        <div id="tab3" class="tab-content">
            <div class="section-header">Markdown File Viewer</div>
            
            <!-- Markdown File Reader Section -->
            <div class="markdown-upload-section">
                <div class="upload-header">
                    <span>📄</span>
                    Read Markdown Files (.md)
                </div>
                <div class="upload-area">
                    <div class="upload-icon">📝</div>
                    <div class="upload-text">Enter filename to read markdown files</div>
                    <div class="upload-subtext">Example: analysis.md, documentation.md, README.md</div>
                    <div style="margin-top: 20px; display: flex; gap: 10px; align-items: center; justify-content: center; flex-wrap: wrap;">
                        <input type="text" id="markdownFilename" placeholder="Enter filename (e.g., analysis.md)" 
                               style="padding: 12px 20px; border: 2px solid #10b981; border-radius: 8px; font-size: 16px; min-width: 300px; background: white; color: #333;"
                               oninput="autoReadFile()">
                        <button onclick="readMarkdownFile()" 
                                style="padding: 12px 25px; background: linear-gradient(135deg, #10b981, #059669); color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; font-size: 16px;">
                            📖 Read File
                        </button>
                    </div>
                    <div style="margin-top: 15px;">
                        <button onclick="document.getElementById('markdownFileInput').click();" 
                                style="padding: 10px 20px; background: rgba(16, 185, 129, 0.1); color: #10b981; border: 2px solid #10b981; border-radius: 8px; font-weight: 600; cursor: pointer;">
                            📁 Or Upload Files
                        </button>
                        <input type="file" id="markdownFileInput" accept=".md,.markdown,.txt" multiple style="display: none;" onchange="handleMarkdownFiles(event)">
                    </div>
                </div>
            </div>

            <!-- Markdown Content Display -->
            <div id="markdownContentContainer">
                <!-- Uploaded markdown files will be displayed here -->
            </div>
        </div>

        <!-- Tab 4 -->
        <div id="tab4" class="tab-content">
            <div class="section-header">Data Visualization</div>
            <div class="content-text">
                This tab contains advanced data visualization tools and interactive charts for malaria analysis.
            </div>
        </div>

        <!-- Tab 5 -->
        <div id="tab5" class="tab-content">
            <div class="section-header">Reports & Export</div>
            <div class="content-text">
                This tab contains report generation and data export functionality.
            </div>
        </div>
    </div>

    <script>
        function openTab(evt, tabName) {
            var tabcontents = document.getElementsByClassName("tab-content");
            for (var i = 0; i < tabcontents.length; i++) {
                tabcontents[i].classList.remove("active");
            }
            
            var tabbuttons = document.getElementsByClassName("tab-button");
            for (var i = 0; i < tabbuttons.length; i++) {
                tabbuttons[i].classList.remove("active");
            }
            
            var targetTab = document.getElementById(tabName);
            if (targetTab) {
                targetTab.classList.add("active");
            }
            if (evt && evt.currentTarget) {
                evt.currentTarget.classList.add("active");
            }
            
            var tabNav = document.getElementById("tabNavigation");
            var toggleBtn = document.getElementById("tabToggleBtn");
            if (tabNav && toggleBtn) {
                tabNav.classList.remove("expanded");
                toggleBtn.classList.add("collapsed");
                toggleBtn.innerHTML = '<span>📂</span><span>Show Navigation Menu</span><span class="arrow">▼</span>';
            }
        }

        function toggleTabs() {
            var tabNav = document.getElementById("tabNavigation");
            var toggleBtn = document.getElementById("tabToggleBtn");
            
            if (tabNav && toggleBtn) {
                if (tabNav.classList.contains("expanded")) {
                    tabNav.classList.remove("expanded");
                    toggleBtn.classList.add("collapsed");
                    toggleBtn.innerHTML = '<span>📂</span><span>Show Navigation Menu</span><span class="arrow">▼</span>';
                } else {
                    tabNav.classList.add("expanded");
                    toggleBtn.classList.remove("collapsed");
                    toggleBtn.innerHTML = '<span>📂</span><span>Hide Navigation Menu</span><span class="arrow">▼</span>';
                }
            }
        }

        function toggleSection(button) {
            if (!button || !button.nextElementSibling) return;
            
            var content = button.nextElementSibling;
            var isCollapsed = content.classList.contains("expanded");
            
            if (isCollapsed) {
                content.classList.remove("expanded");
                button.classList.add("collapsed");
            } else {
                content.classList.add("expanded");
                button.classList.remove("collapsed");
            }
        }

        // Auto-read code file functionality
        let autoReadCodeTimeout;
        function autoReadCodeFile() {
            const filename = document.getElementById('codeFilename').value.trim();
            
            // Clear previous timeout
            clearTimeout(autoReadCodeTimeout);
            
            // Only auto-read if filename ends with .md, .markdown, or .txt and has reasonable length
            if (filename && (filename.endsWith('.md') || filename.endsWith('.markdown') || filename.endsWith('.txt')) && filename.length > 3) {
                // Debounce the auto-read to avoid too many requests
                autoReadCodeTimeout = setTimeout(() => {
                    readCodeFile();
                }, 800); // Wait 800ms after user stops typing
            }
        }

        // Read code file functionality
        async function readCodeFile() {
            const filename = document.getElementById('codeFilename').value.trim();
            const container = document.getElementById('codeContentContainer');
            
            if (!filename) {
                alert('Please enter a filename (e.g., malaria_code.md)');
                return;
            }
            
            try {
                // Show loading message
                const loadingSection = document.createElement('div');
                loadingSection.className = 'collapsible-section';
                loadingSection.innerHTML = `
                    <button class="section-toggle" style="background: linear-gradient(135deg, #f59e0b, #d97706);">
                        ⏳ Loading ${filename}...
                    </button>
                `;
                container.appendChild(loadingSection);
                
                // Read the file using the window.fs.readFile API
                const content = await window.fs.readFile(filename, { encoding: 'utf8' });
                
                // Remove loading message
                container.removeChild(loadingSection);
                
                // Display the content
                displayMarkdownContent(filename, content, container);
                
                // Clear the input
                document.getElementById('codeFilename').value = '';
                
            } catch (error) {
                // Remove loading message if it exists
                const loadingElements = container.querySelectorAll('.collapsible-section');
                loadingElements.forEach(el => {
                    if (el.textContent.includes('Loading')) {
                        container.removeChild(el);
                    }
                });
                
                // Show error message
                const errorSection = document.createElement('div');
                errorSection.className = 'collapsible-section';
                errorSection.innerHTML = `
                    <button class="section-toggle" style="background: linear-gradient(135deg, #ef4444, #dc2626);">
                        ❌ Error reading ${filename}
                    </button>
                    <div class="section-content" style="max-height: none; padding: 20px;">
                        <div style="background: #fee2e2; border: 1px solid #ef4444; border-radius: 8px; padding: 15px; color: #dc2626;">
                            <strong>File not found:</strong> ${filename}<br>
                            <small>Make sure the file exists and the filename is correct (including .md extension)</small>
                        </div>
                    </div>
                `;
                container.appendChild(errorSection);
                
                console.error('Error reading code file:', error);
            }
        }

        // Enhanced Markdown handling - Read files directly
        async function readMarkdownFile() {
            const filename = document.getElementById('markdownFilename').value.trim();
            const container = document.getElementById('markdownContentContainer');
            
            if (!filename) {
                alert('Please enter a filename (e.g., analysis.md)');
                return;
            }
            
            try {
                // Show loading message
                const loadingSection = document.createElement('div');
                loadingSection.className = 'collapsible-section';
                loadingSection.innerHTML = `
                    <button class="section-toggle" style="background: linear-gradient(135deg, #f59e0b, #d97706);">
                        ⏳ Loading ${filename}...
                    </button>
                `;
                container.appendChild(loadingSection);
                
                // Read the file using the window.fs.readFile API
                const content = await window.fs.readFile(filename, { encoding: 'utf8' });
                
                // Remove loading message
                container.removeChild(loadingSection);
                
                // Display the content
                displayMarkdownContent(filename, content, container);
                
                // Clear the input
                document.getElementById('markdownFilename').value = '';
                
            } catch (error) {
                // Remove loading message if it exists
                const loadingElements = container.querySelectorAll('.collapsible-section');
                loadingElements.forEach(el => {
                    if (el.textContent.includes('Loading')) {
                        container.removeChild(el);
                    }
                });
                
                // Show error message
                const errorSection = document.createElement('div');
                errorSection.className = 'collapsible-section';
                errorSection.innerHTML = `
                    <button class="section-toggle" style="background: linear-gradient(135deg, #ef4444, #dc2626);">
                        ❌ Error reading ${filename}
                    </button>
                    <div class="section-content" style="max-height: none; padding: 20px;">
                        <div style="background: #fee2e2; border: 1px solid #ef4444; border-radius: 8px; padding: 15px; color: #dc2626;">
                            <strong>File not found:</strong> ${filename}<br>
                            <small>Make sure the file exists and the filename is correct (including .md extension)</small>
                        </div>
                    </div>
                `;
                container.appendChild(errorSection);
                
                console.error('Error reading markdown file:', error);
            }
        }

        // Handle Enter key press in filename input
        document.addEventListener('DOMContentLoaded', function() {
            const filenameInput = document.getElementById('markdownFilename');
            if (filenameInput) {
                filenameInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        readMarkdownFile();
                    }
                });
            }
        });

        function handleMarkdownFiles(event) {
            const files = event.target.files;
            const container = document.getElementById('markdownContentContainer');
            
            for (let file of files) {
                if (file.type === 'text/markdown' || file.name.endsWith('.md') || file.name.endsWith('.markdown') || file.type === 'text/plain') {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const content = e.target.result;
                        displayMarkdownContent(file.name, content, container);
                    };
                    reader.readAsText(file);
                }
            }
        }

        function displayMarkdownContent(filename, content, container) {
            const section = document.createElement('div');
            section.className = 'collapsible-section';
            
            const toggle = document.createElement('button');
            toggle.className = 'section-toggle collapsed';
            toggle.onclick = function() { toggleSection(this); };
            toggle.innerHTML = `📄 ${filename}`;
            
            const sectionContent = document.createElement('div');
            sectionContent.className = 'section-content';
            
            const copyBtn = document.createElement('button');
            copyBtn.className = 'copy-btn';
            copyBtn.style.margin = '10px 0';
            copyBtn.innerHTML = '<span>📋</span> Copy Content';
            copyBtn.onclick = function() {
                navigator.clipboard.writeText(content).then(function() {
                    copyBtn.innerHTML = '<span>✅</span> Copied!';
                    copyBtn.classList.add('copied');
                    setTimeout(function() {
                        copyBtn.innerHTML = '<span>📋</span> Copy Content';
                        copyBtn.classList.remove('copied');
                    }, 2000);
                });
            };
            
            const markdownDiv = document.createElement('div');
            markdownDiv.className = 'content-text';
            markdownDiv.style.maxHeight = 'none';
            markdownDiv.style.overflow = 'visible';
            markdownDiv.innerHTML = parseMarkdownToHTML(content);
            
            sectionContent.appendChild(copyBtn);
            sectionContent.appendChild(markdownDiv);
            section.appendChild(toggle);
            section.appendChild(sectionContent);
            container.appendChild(section);
        }

        function parseMarkdownToHTML(content) {
            // Parse markdown content to HTML with enhanced color scheme
            let html = content
                // Escape HTML first
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                
                // Headers with enhanced styling
                .replace(/^### (.*$)/gm, '<h3 style="color: #059669; font-size: 1.4em; font-weight: 600; margin: 25px 0 15px 0; padding: 12px 20px; background: linear-gradient(135deg, #f0fdf4, #dcfce7); border-left: 5px solid #059669; border-radius: 8px; box-shadow: 0 2px 8px rgba(5, 150, 105, 0.1);">🔹 $1</h3>')
                .replace(/^## (.*$)/gm, '<h2 style="color: #0066cc; font-size: 1.6em; font-weight: 700; margin: 30px 0 20px 0; padding: 15px 25px; background: linear-gradient(135deg, #eff6ff, #dbeafe); border-left: 6px solid #0066cc; border-radius: 10px; box-shadow: 0 4px 12px rgba(0, 102, 204, 0.15);">📊 $1</h2>')
                .replace(/^# (.*$)/gm, '<h1 style="color: #004499; font-size: 1.8em; font-weight: 700; margin: 40px 0 25px 0; padding: 20px 30px; background: linear-gradient(135deg, #f0f8ff, #e0f2fe); border: 2px solid #004499; border-radius: 12px; text-align: center; box-shadow: 0 6px 20px rgba(0, 68, 153, 0.2);">🎯 $1</h1>')
                
                // Enhanced section separators
                .replace(/^---$/gm, '<hr style="margin: 30px 0; border: none; height: 3px; background: linear-gradient(to right, #0066cc, #10b981, #0066cc); border-radius: 3px; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);">')
                
                // Bold text with color
                .replace(/\*\*(.*?)\*\*/g, '<strong style="color: #004499; font-weight: 700; background: linear-gradient(135deg, #f0f8ff, transparent); padding: 2px 4px; border-radius: 4px;">$1</strong>')
                .replace(/__(.*?)__/g, '<strong style="color: #004499; font-weight: 700; background: linear-gradient(135deg, #f0f8ff, transparent); padding: 2px 4px; border-radius: 4px;">$1</strong>')
                
                // Italic text with subtle styling
                .replace(/\*(.*?)\*/g, '<em style="color: #059669; font-style: italic; font-weight: 500;">$1</em>')
                .replace(/_(.*?)_/g, '<em style="color: #059669; font-style: italic; font-weight: 500;">$1</em>')
                
                // Enhanced inline code
                .replace(/`([^`]+)`/g, '<code style="background: linear-gradient(135deg, #f0fdf4, #dcfce7); color: #059669; padding: 4px 8px; border-radius: 6px; font-family: monospace; font-size: 0.9em; border: 1px solid #bbf7d0; font-weight: 600;">$1</code>')
                
                // Enhanced links
                .replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2" style="color: #0066cc; text-decoration: none; font-weight: 600; padding: 2px 6px; border-radius: 4px; background: linear-gradient(135deg, #eff6ff, transparent); border-bottom: 2px solid #0066cc; transition: all 0.3s ease;">🔗 $1</a>')
                
                // Enhanced lists with icons and colors
                .replace(/^\s*[-*+]\s+(.+)$/gm, function(match, content) {
                    if (content.includes('**')) {
                        return '<li style="margin: 8px 0; color: #004499; font-weight: 600; padding: 8px 12px; background: linear-gradient(135deg, #f0f8ff, #ffffff); border-left: 4px solid #0066cc; border-radius: 6px;">🔸 ' + content + '</li>';
                    } else {
                        return '<li style="margin: 6px 0; color: #374151; padding: 6px 10px; background: linear-gradient(135deg, #f9fafb, #ffffff); border-left: 3px solid #10b981; border-radius: 4px;">• ' + content + '</li>';
                    }
                })
                
                // Enhanced ordered lists
                .replace(/^\s*(\d+)\.\s+(.+)$/gm, '<li style="margin: 8px 0; color: #374151; padding: 8px 12px; background: linear-gradient(135deg, #fef3c7, #ffffff); border-left: 4px solid #f59e0b; border-radius: 6px; list-style-type: none;"><span style="color: #f59e0b; font-weight: 700; margin-right: 8px;">$1.</span>$2</li>')
                
                // Enhanced code blocks
                .replace(/```[\s\S]*?```/g, function(match) {
                    const codeContent = match.replace(/```(\w+)?\n?/g, '').replace(/```$/g, '');
                    return `<div style="background: linear-gradient(135deg, #f8fafc, #f1f5f9); border: 2px solid #cbd5e1; border-radius: 12px; padding: 20px; margin: 20px 0; font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace; font-size: 0.9em; color: #475569; white-space: pre-wrap; overflow-x: auto; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);"><div style="color: #0066cc; font-weight: 600; margin-bottom: 10px; font-family: sans-serif;">💻 Code Block</div>${codeContent}</div>`;
                })
                
                // Line breaks and paragraphs
                .replace(/\n\n/g, '</p><p style="margin: 18px 0; line-height: 1.7; color: #374151; text-align: justify;">')
                .replace(/\n/g, '<br>');
            
            // Wrap in paragraph tags with enhanced styling
            html = '<p style="margin: 18px 0; line-height: 1.7; color: #374151; text-align: justify;">' + html + '</p>';
            
            // Wrap lists in enhanced ul/ol tags
            html = html.replace(/(<li[^>]*>.*?<\/li>)(?:\s*<br>\s*<li[^>]*>.*?<\/li>)*/g, function(match) {
                if (match.includes('list-style-type: none')) {
                    return '<ol style="margin: 20px 0; padding: 15px 20px; background: linear-gradient(135deg, #fffbeb, #fef3c7); border-radius: 10px; box-shadow: 0 2px 8px rgba(245, 158, 11, 0.1);">' + match.replace(/<br>\s*/g, '') + '</ol>';
                } else {
                    return '<ul style="margin: 20px 0; padding: 15px 20px; background: linear-gradient(135deg, #f0fdf4, #dcfce7); border-radius: 10px; box-shadow: 0 2px 8px rgba(16, 185, 129, 0.1);">' + match.replace(/<br>\s*/g, '') + '</ul>';
                }
            });
            
            return html;
        }

        // Auto-read file functionality with debouncing
        let autoReadTimeout;
        function autoReadFile() {
            const filename = document.getElementById('markdownFilename').value.trim();
            
            // Clear previous timeout
            clearTimeout(autoReadTimeout);
            
            // Only auto-read if filename ends with .md, .markdown, or .txt and has reasonable length
            if (filename && (filename.endsWith('.md') || filename.endsWith('.markdown') || filename.endsWith('.txt')) && filename.length > 3) {
                // Debounce the auto-read to avoid too many requests
                autoReadTimeout = setTimeout(() => {
                    readMarkdownFile();
                }, 800); // Wait 800ms after user stops typing
            }
        }

        // Drag and drop functionality for file upload (optional)
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize collapsed navigation
            var tabNav = document.getElementById("tabNavigation");
            var toggleBtn = document.getElementById("tabToggleBtn");
            
            if (tabNav && toggleBtn) {
                tabNav.classList.remove("expanded");
                toggleBtn.classList.add("collapsed");
            }
            
            // Initialize all content sections as collapsed
            var sections = document.querySelectorAll('.section-content');
            var buttons = document.querySelectorAll('.section-toggle');
            
            sections.forEach(function(section) {
                if (section) section.classList.remove('expanded');
            });
            
            buttons.forEach(function(button) {
                if (button) button.classList.add('collapsed');
            });

            // Add Enter key handlers for both markdown inputs
            const filenameInput = document.getElementById('markdownFilename');
            const codeFilenameInput = document.getElementById('codeFilename');
            
            if (filenameInput) {
                filenameInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        readMarkdownFile();
                    }
                });
                
                // Focus on the input field when tab is opened
                if (document.getElementById('tab3').classList.contains('active')) {
                    filenameInput.focus();
                }
            }
            
            if (codeFilenameInput) {
                codeFilenameInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        readCodeFile();
                    }
                });
                
                // Focus on the input field when tab is opened
                if (document.getElementById('tab2').classList.contains('active')) {
                    codeFilenameInput.focus();
                }
            }
        });
    </script>
</body>
</html>
