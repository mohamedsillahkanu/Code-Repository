<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Code Repository</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0066cc 0%, #004499 50%, #ffffff 100%);
            min-height: 100vh;
            color: #333;
            padding: 0;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 2px solid #0066cc;
            padding: 25px 0;
            margin-bottom: 40px;
            box-shadow: 0 2px 10px rgba(0, 102, 204, 0.1);
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .logo-section {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 30px;
        }

        .logo-container {
            width: 140px;
            height: 90px;
            border: 2px solid #0066cc;
            border-radius: 12px;
            overflow: hidden;
            background: white;
            box-shadow: 0 4px 12px rgba(0, 102, 204, 0.15);
            transition: transform 0.3s ease;
        }

        .logo-container:hover {
            transform: translateY(-3px);
        }

        .logo-image {
            width: 100%;
            height: 100%;
            object-fit: contain;
            padding: 8px;
        }

        .title-section {
            text-align: center;
        }

        .main-title {
            font-size: 3em;
            color: #0066cc;
            font-weight: 700;
            margin-bottom: 15px;
            text-shadow: 0 2px 4px rgba(0, 102, 204, 0.3);
        }

        .subtitle {
            font-size: 1.4em;
            color: #004499;
            font-weight: 400;
        }

        .dashboard-container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 50px;
            box-shadow: 0 15px 40px rgba(0, 102, 204, 0.2);
            border: 1px solid rgba(0, 102, 204, 0.2);
        }

        /* Tab Toggle Button */
        .tab-toggle-btn {
            background: linear-gradient(135deg, #004499, #0066cc);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            margin-bottom: 20px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 68, 153, 0.3);
            font-size: 1.1em;
            display: flex;
            align-items: center;
            gap: 10px;
            justify-content: center;
            width: 250px;
        }

        .tab-toggle-btn:hover {
            background: linear-gradient(135deg, #0066cc, #004499);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 102, 204, 0.4);
        }

        .tab-toggle-btn .arrow {
            font-size: 1.2em;
            transition: transform 0.3s ease;
        }

        .tab-toggle-btn.collapsed .arrow {
            transform: rotate(-90deg);
        }

        /* Tab Navigation */
        .tab-navigation {
            display: flex;
            flex-wrap: wrap;
            border-bottom: 3px solid #0066cc;
            margin-bottom: 40px;
            gap: 5px;
            max-height: 0;
            overflow: hidden;
            opacity: 0;
            transition: all 0.5s ease;
        }

        .tab-navigation.expanded {
            max-height: 200px;
            opacity: 1;
            margin-bottom: 40px;
        }

        .tab-button {
            background: rgba(0, 102, 204, 0.1);
            border: none;
            padding: 15px 25px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            color: #004499;
            border-radius: 10px 10px 0 0;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            margin-bottom: -3px;
            position: relative;
        }

        .tab-button:hover {
            background: rgba(0, 102, 204, 0.2);
            color: #0066cc;
        }

        .tab-button.active {
            background: #0066cc;
            color: white;
            border-bottom: 3px solid #0066cc;
            transform: translateY(3px);
        }

        /* Tab Content */
        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease-in;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Content Sections */
        .section-header {
            color: #0066cc;
            font-size: 2.2em;
            font-weight: 700;
            margin-bottom: 30px;
            text-align: center;
            padding: 20px;
            background: rgba(0, 102, 204, 0.1);
            border-radius: 15px;
            border-left: 5px solid #0066cc;
        }

        /* Collapsible Sections */
        .collapsible-section {
            margin-bottom: 30px;
            border: 2px solid rgba(0, 102, 204, 0.2);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 102, 204, 0.1);
        }

        .section-toggle {
            background: linear-gradient(135deg, #0066cc, #004499);
            color: white;
            border: none;
            padding: 20px;
            width: 100%;
            text-align: left;
            cursor: pointer;
            font-size: 1.3em;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .section-toggle:hover {
            background: linear-gradient(135deg, #004499, #0066cc);
        }

        .section-toggle::after {
            content: '▼';
            font-size: 1.2em;
            transition: transform 0.3s ease;
        }

        .section-toggle.collapsed::after {
            transform: rotate(-90deg);
        }

        .section-content {
            background: rgba(255, 255, 255, 0.95);
            max-height: 0;
            overflow: hidden;
            transition: all 0.5s ease;
            padding: 0;
        }

        .section-content.expanded {
            max-height: none;
            padding: 20px;
        }

        .content-text {
            font-size: 1.1em;
            line-height: 1.6;
            color: #333;
            margin-bottom: 25px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 10px;
            border-left: 4px solid #0066cc;
        }

        /* Step Description */
        .step-description {
            background: rgba(0, 102, 204, 0.05);
            border-left: 4px solid #0066cc;
            padding: 15px 20px;
            margin-bottom: 20px;
            border-radius: 0 10px 10px 0;
            color: #004499;
            font-size: 1em;
            line-height: 1.5;
            font-weight: 500;
        }

        /* Code Section Styling */
        .code-section {
            margin: 30px 0;
            border: 2px solid rgba(59, 130, 246, 0.3);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(59, 130, 246, 0.1);
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
        }

        .code-header {
            background: linear-gradient(135deg, #3b82f6, #1e40af);
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .code-title {
            font-weight: 600;
            font-size: 1.1em;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .copy-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .copy-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .copy-btn.copied {
            background: #10b981;
            border-color: #10b981;
        }

        .code-container {
            background: #1e293b;
            padding: 0;
            position: relative;
            overflow-x: auto;
        }

        .code-content {
            padding: 25px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 14px;
            line-height: 1.6;
            color: #e2e8f0;
            white-space: pre;
            overflow-x: auto;
        }

        /* Direct CSS styling for Python keywords - NO JavaScript needed */
        .code-content {
            padding: 25px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 14px;
            line-height: 1.6;
            color: #e2e8f0;
            white-space: pre;
            overflow-x: auto;
        }

        /* Color specific Python words directly */
        .code-content:has-text("import"),
        .code-content:contains("import") {
            color: #c678dd;
        }

        /* Alternative approach - use data attributes */
        .code-content[data-lang="python"] {
            background: #1e293b;
        }

        /* Reset to clean approach - just clean monospace font */
        .code-content {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 14px;
            line-height: 1.6;
            color: #e2e8f0 !important;
            white-space: pre;
            overflow-x: auto;
            padding: 25px;
            background: #1e293b;
        }

        /* Loading indicator */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            color: #0066cc;
        }

        .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid #e2e8f0;
            border-top: 2px solid #0066cc;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .main-title {
                font-size: 2.2em;
            }
            
            .subtitle {
                font-size: 1.2em;
            }
            
            .logo-section {
                justify-content: center;
            }
            
            .logo-container {
                width: 120px;
                height: 80px;
            }
            
            .dashboard-container {
                padding: 30px;
            }

            .tab-navigation {
                flex-direction: column;
            }

            .tab-button {
                border-radius: 10px;
                margin-bottom: 5px;
                padding: 12px 20px;
                font-size: 0.9em;
            }

            .tab-button.active {
                transform: none;
            }

            .tab-toggle-btn {
                width: 200px;
                padding: 12px 20px;
                font-size: 1em;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <!-- Logo Section for 4 logos -->
            <div class="logo-section">
                <div class="logo-container">
                    <img src="NMCP.png" alt="NMCP Logo" class="logo-image">
                </div>
                
                <div class="logo-container">
                    <img src="WHO.png" alt="WHO Logo" class="logo-image">
                </div>
                
                <div class="logo-container">
                    <img src="CHAI2.png" alt="CHAI Logo" class="logo-image">
                </div>

                <div class="logo-container">
                    <img src="ICF-SL.jpg" alt="ICF-SL Logo" class="logo-image">
                </div>
            </div>
            
            <!-- Title Section -->
            <div class="title-section">
                <h1 class="main-title">Malaria Program Review (MPR)-2025</h1>
                <h2 class="subtitle">Code Repository</h2>
                
            </div>
        </div>
    </div>

    <div class="dashboard-container">
        <!-- Tab Toggle Button -->
        <button class="tab-toggle-btn collapsed" onclick="toggleTabs()" id="tabToggleBtn">
            <span>📂</span>
            <span>Show Navigation Menu</span>
            <span class="arrow">▼</span>
        </button>

        <!-- Dynamic Tab Navigation - Will be populated by JavaScript -->
        <div class="tab-navigation" id="tabNavigation">
            <!-- Tabs will be generated dynamically from tab_config.json -->
        </div>

        <!-- Tab Contents -->
        <div id="overview" class="tab-content active">
            <div class="section-header">Code Repository</div>
            
            <!-- Code Repository Introduction -->
            <div class="collapsible-section">
                <button class="section-toggle collapsed" onclick="toggleSection(this)">
                    💻 Code Repository Overview
                </button>
                <div class="section-content">
                    <div class="content-text">
                        <strong>Malaria Data Analysis Code Repository</strong><br>
                        This system provides a comprehensive collection of Python scripts and analysis tools designed specifically for the National Malaria Control Programme (NMCP) in Sierra Leone. 
                        The code repository contains standardized functions for processing malaria surveillance data, calculating key indicators, and generating analytical reports that support evidence-based decision making.
                    </div>
                </div>
            </div>
        </div>

        <!-- Dynamic Tab Contents will be populated here -->
        <div id="tab2" class="tab-content">
            <div class="section-header">Malaria Analysis Code</div>
            <div class="loading" id="loading-tab2">
                <div class="spinner"></div>
                Loading content...
            </div>
        </div>

        <div id="tab3" class="tab-content">
            <div class="section-header">Data Visualization</div>
            <div class="loading" id="loading-tab3">
                <div class="spinner"></div>
                Loading content...
            </div>
        </div>

        <div id="tab4" class="tab-content">
            <div class="section-header">Reports & Export</div>
            <div class="loading" id="loading-tab4">
                <div class="spinner"></div>
                Loading content...
            </div>
        </div>
    </div>

    <script>
        // Dynamic Tab Configuration System - Load from external config file
        let TAB_CONFIG = {};
        let dynamicTabs = [];

        // Load configuration from external JSON file
        async function loadTabConfiguration() {
            try {
                const response = await fetch('tab_config.json');
                if (response.ok) {
                    const config = await response.json();
                    TAB_CONFIG = config.tabs || {};
                    dynamicTabs = config.navigation || [];
                    
                    // Generate navigation dynamically
                    generateDynamicNavigation();
                    
                    console.log('✅ Tab configuration loaded successfully');
                    return true;
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                console.warn('⚠️ Could not load tab_config.json, using default configuration');
                console.warn('📝 Create tab_config.json file to customize tabs and files');
                
                // Fallback to default configuration
                loadDefaultConfiguration();
                return false;
            }
        }

        // Default configuration if tab_config.json is not found
        function loadDefaultConfiguration() {
            TAB_CONFIG = {
                'tab2': { file: 'malaria_analysis.md', title: 'Malaria Analysis Code' },
                'tab3': { file: 'data_visualization.md', title: 'Data Visualization' },
                'tab4': { file: 'reports_export.md', title: 'Reports & Export' }
            };
            
            dynamicTabs = [
                { id: 'overview', title: 'Overview', default: true },
                { id: 'tab2', title: 'Malaria Analysis Code' },
                { id: 'tab3', title: 'Data Visualization' },
                { id: 'tab4', title: 'Reports & Export' }
            ];
            
            generateDynamicNavigation();
        }

        // Generate navigation tabs dynamically
        function generateDynamicNavigation() {
            const tabNavigation = document.getElementById('tabNavigation');
            if (!tabNavigation) return;
            
            // Clear existing tabs
            tabNavigation.innerHTML = '';
            
            // Generate tabs from configuration
            dynamicTabs.forEach((tab, index) => {
                const button = document.createElement('button');
                button.className = `tab-button ${tab.default ? 'active' : ''}`;
                button.onclick = (event) => openTab(event, tab.id);
                button.textContent = tab.title;
                tabNavigation.appendChild(button);
                
                // Create tab content container if it doesn't exist (except overview)
                if (tab.id !== 'overview' && !document.getElementById(tab.id)) {
                    createTabContainer(tab.id, tab.title);
                }
            });
        }

        // Create tab content container
        function createTabContainer(tabId, title) {
            const dashboardContainer = document.querySelector('.dashboard-container');
            if (!dashboardContainer) return;
            
            const tabDiv = document.createElement('div');
            tabDiv.id = tabId;
            tabDiv.className = 'tab-content';
            tabDiv.innerHTML = `
                <div class="section-header">${title}</div>
                <div class="loading" id="loading-${tabId}">
                    <div class="spinner"></div>
                    Loading content...
                </div>
            `;
            
            dashboardContainer.appendChild(tabDiv);
        }

        function openTab(evt, tabName) {
            // Hide all tab contents
            var tabcontents = document.getElementsByClassName("tab-content");
            for (var i = 0; i < tabcontents.length; i++) {
                tabcontents[i].classList.remove("active");
            }
            
            // Remove active class from all tab buttons
            var tabbuttons = document.getElementsByClassName("tab-button");
            for (var i = 0; i < tabbuttons.length; i++) {
                tabbuttons[i].classList.remove("active");
            }
            
            // Show the selected tab content and mark button as active
            var targetTab = document.getElementById(tabName);
            if (targetTab) {
                targetTab.classList.add("active");
            }
            if (evt && evt.currentTarget) {
                evt.currentTarget.classList.add("active");
            }
            
            // Load content if not already loaded
            if (TAB_CONFIG[tabName] && !targetTab.dataset.loaded) {
                loadTabContent(tabName);
            }
            
            // Auto-collapse navigation after tab selection
            var tabNav = document.getElementById("tabNavigation");
            var toggleBtn = document.getElementById("tabToggleBtn");
            if (tabNav && toggleBtn) {
                tabNav.classList.remove("expanded");
                toggleBtn.classList.add("collapsed");
                toggleBtn.innerHTML = '<span>📂</span><span>Show Navigation Menu</span><span class="arrow">▼</span>';
            }
        }

        function toggleTabs() {
            var tabNav = document.getElementById("tabNavigation");
            var toggleBtn = document.getElementById("tabToggleBtn");
            
            if (tabNav && toggleBtn) {
                if (tabNav.classList.contains("expanded")) {
                    // Collapse the menu
                    tabNav.classList.remove("expanded");
                    toggleBtn.classList.add("collapsed");
                    toggleBtn.innerHTML = '<span>📂</span><span>Show Navigation Menu</span><span class="arrow">▼</span>';
                } else {
                    // Expand the menu
                    tabNav.classList.add("expanded");
                    toggleBtn.classList.remove("collapsed");
                    toggleBtn.innerHTML = '<span>📂</span><span>Hide Navigation Menu</span><span class="arrow">▼</span>';
                }
            }
        }

        function toggleSection(button) {
            if (!button || !button.nextElementSibling) return;
            
            var content = button.nextElementSibling;
            var isCollapsed = content.classList.contains("expanded");
            
            if (isCollapsed) {
                content.classList.remove("expanded");
                button.classList.add("collapsed");
            } else {
                content.classList.add("expanded");
                button.classList.remove("collapsed");
            }
        }

        function copyCode(elementId) {
            const codeContent = document.getElementById(elementId);
            if (!codeContent) return;
            
            // Find the copy button (next button in the code header)
            const codeSection = codeContent.closest('.code-section');
            const copyBtn = codeSection ? codeSection.querySelector('.copy-btn') : null;
            if (!copyBtn) return;
            
            // Get the text content without HTML tags
            const textContent = codeContent.innerText || codeContent.textContent;
            
            // Copy to clipboard
            navigator.clipboard.writeText(textContent).then(function() {
                // Change button appearance
                const originalHTML = copyBtn.innerHTML;
                copyBtn.innerHTML = '<span>✅</span> Copied!';
                copyBtn.classList.add('copied');
                
                // Reset button after 2 seconds
                setTimeout(function() {
                    copyBtn.innerHTML = originalHTML;
                    copyBtn.classList.remove('copied');
                }, 2000);
            }).catch(function(err) {
                console.error('Could not copy text: ', err);
                // Fallback for older browsers
                const textarea = document.createElement('textarea');
                textarea.value = textContent;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                
                const originalHTML = copyBtn.innerHTML;
                copyBtn.innerHTML = '<span>✅</span> Copied!';
                copyBtn.classList.add('copied');
                
                setTimeout(function() {
                    copyBtn.innerHTML = originalHTML;
                    copyBtn.classList.remove('copied');
                }, 2000);
            });
        }

        // Load markdown content from file
        async function loadTabContent(tabName) {
            const config = TAB_CONFIG[tabName];
            if (!config) return;

            const tabElement = document.getElementById(tabName);
            const loadingElement = document.getElementById(`loading-${tabName}`);
            
            try {
                // Show loading
                if (loadingElement) {
                    loadingElement.style.display = 'flex';
                }

                const response = await fetch(config.file);
                if (!response.ok) {
                    throw new Error(`Failed to load ${config.file}: ${response.status}`);
                }
                
                const markdown = await response.text();
                const sections = parseMarkdown(markdown);
                
                // Render sections
                const renderedSections = sections.map((section, idx) => renderSection(section, idx)).join('');
                
                // Update tab content
                if (tabElement) {
                    const header = tabElement.querySelector('.section-header').outerHTML;
                    tabElement.innerHTML = header + renderedSections;
                }
                
                // Mark as loaded
                tabElement.dataset.loaded = 'true';
                
            } catch (error) {
                console.error('Error loading tab content:', error);
                // Show error message
                if (tabElement) {
                    const header = tabElement.querySelector('.section-header').outerHTML;
                    tabElement.innerHTML = header + `
                        <div class="content-text" style="color: #dc2626; border-left-color: #dc2626;">
                            <strong>Error loading content:</strong><br>
                            Could not load ${config.file}. Please ensure the file exists in the main repository directory.
                            <br><br>
                            <em>Expected files in main repo:</em><br>
                            - malaria_analysis.md<br>
                            - data_visualization.md<br>
                            - reports_export.md
                            <br><br>
                            <em>Current attempt:</em> Trying to load "${config.file}"
                        </div>
                    `;
                }
            } finally {
                // Hide loading
                if (loadingElement) {
                    loadingElement.style.display = 'none';
                }
            }
        }

        // Markdown parsing and rendering functions
        function parseMarkdown(markdown) {
            // Split into sections based on ## headers
            const sections = [];
            const lines = markdown.split('\n');
            let currentSection = null;
            let currentContent = [];

            for (let line of lines) {
                if (line.startsWith('## ')) {
                    // Save previous section if exists
                    if (currentSection) {
                        sections.push({
                            title: currentSection,
                            content: currentContent.join('\n').trim()
                        });
                    }
                    // Start new section
                    currentSection = line.substring(3).trim();
                    currentContent = [];
                } else {
                    currentContent.push(line);
                }
            }

            // Add last section
            if (currentSection) {
                sections.push({
                    title: currentSection,
                    content: currentContent.join('\n').trim()
                });
            }

            return sections;
        }

        function formatCodeBlock(code, language = '') {
            // Escape HTML entities first
            let escaped = code
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/"/g, '&quot;')
                .replace(/'/g, '&#39;');
            
            // Apply if-else color highlighting
            if (language === 'python' || language === 'py' || language === '') {
                return applyIfElseColors(escaped);
            }
            
            return escaped;
        }

        function applyIfElseColors(code) {
            // Split code into lines and apply colors using if-else logic
            let result = '';
            const lines = code.split('\n');
            
            lines.forEach((line, lineIndex) => {
                // Check if entire line is a comment first (any line starting with # regardless of spacing)
                const trimmedLine = line.trim();
                if (trimmedLine.startsWith('#')) {
                    // If entire line starts with #, make it bright blue bold
                    result += `<span style="color: #3399ff; font-weight: bold;">${line}</span>`;
                } else {
                    // Process line word by word for other highlighting
                    const words = line.split(/(\s+)/); // Split but keep whitespace
                    
                    words.forEach(word => {
                        // Skip empty words
                        if (!word.trim()) {
                            result += word;
                            return;
                        }
                        
                        // If-else color logic for each word
                        if (word.includes('#')) {
                            // If word contains #, make it gray italic (comments)
                            result += `<span style="color: #6a9955; font-style: italic;">${word}</span>`;
                        }
                        else if (word === 'print') {
                            // If print statement, make it bright magenta
                            result += `<span style="color: #d73a49; font-weight: bold;">${word}</span>`;
                        }
                        else if (word.includes('.') && !word.startsWith('.') && !word.endsWith('.')) {
                            // If word contains dot (method calls like df.head, data.shape), split and color
                            const parts = word.split('.');
                            let coloredParts = [];
                            
                            parts.forEach((part, index) => {
                                if (index === 0) {
                                    // First part (object name) - check if it's a DataFrame
                                    if (part === 'df' || part === 'data' || part === 'dataset' || part === 'dataframe' || part === 'DataFrame' || part === 'Series' || part === 'series' || part === 'matrix' || part === 'array' || part === 'Array' || part === 'ndarray' || part === 'tensor' || part === 'Tensor' || part === 'malaria_data' || part === 'cases_df' || part === 'stats_df' || part === 'results_df' || part === 'clean_data' || part === 'raw_data' || part === 'processed_data' || part === 'filtered_data' || part === 'merged_data' || part === 'grouped_data') {
                                        coloredParts.push(`<span style="color: #0366d6; font-weight: bold;">${part}</span>`);
                                    } else if (part === 'pandas' || part === 'pd' || part === 'numpy' || part === 'np' || part === 'matplotlib' || part === 'plt' || part === 'seaborn' || part === 'sns') {
                                        coloredParts.push(`<span style="color: #e36209; font-weight: bold;">${part}</span>`);
                                    } else {
                                        coloredParts.push(part);
                                    }
                                } else {
                                    // Method/attribute names after dot - make them bright purple
                                    coloredParts.push(`<span style="color: #6f42c1; font-weight: bold;">${part}</span>`);
                                }
                            });
                            
                            result += coloredParts.join('.');
                        }
                        else if (word === 'import' || word === 'from' || word === 'as' || word === 'def' || word === 'class' || word === 'return' || word === 'if' || word === 'else' || word === 'elif' || word === 'for' || word === 'while' || word === 'try' || word === 'except' || word === 'with' || word === 'in' || word === 'and' || word === 'or' || word === 'not' || word === 'is' || word === 'lambda' || word === 'yield' || word === 'break' || word === 'continue' || word === 'pass' || word === 'raise' || word === 'assert' || word === 'del' || word === 'global' || word === 'nonlocal' || word === 'async' || word === 'await') {
                            // If keyword, make it purple
                            result += `<span style="color: #c678dd; font-weight: bold;">${word}</span>`;
                        }
                        else if (word === 'pandas' || word === 'pd' || word === 'numpy' || word === 'np' || word === 'matplotlib' || word === 'plt' || word === 'seaborn' || word === 'sns' || word === 'tensorflow' || word === 'tf' || word === 'sklearn' || word === 'sk' || word === 'plotly' || word === 'px' || word === 'scipy' || word === 'sp' || word === 'opencv' || word === 'cv2' || word === 'requests' || word === 'flask' || word === 'django' || word === 'fastapi' || word === 'sqlalchemy' || word === 'pytest' || word === 'streamlit' || word === 'dash' || word === 'bokeh' || word === 'altair' || word === 'folium' || word === 'geopandas' || word === 'gpd' || word === 'xgboost' || word === 'lgb' || word === 'catboost' || word === 'statsmodels' || word === 'sm' || word === 'networkx' || word === 'nx' || word === 'beautifulsoup4' || word === 'bs4' || word === 'scrapy' || word === 'selenium' || word === 'pymongo' || word === 'redis' || word === 'psycopg2' || word === 'mysql' || word === 'sqlite3') {
                            // If package/alias, make it red
                            result += `<span style="color: #ff6b6b; font-weight: bold;">${word}</span>`;
                        }
                        else if (word === 'df' || word === 'data' || word === 'dataset' || word === 'dataframe' || word === 'DataFrame' || word === 'Series' || word === 'series' || word === 'matrix' || word === 'array' || word === 'Array' || word === 'ndarray' || word === 'tensor' || word === 'Tensor' || word === 'malaria_data' || word === 'cases_df' || word === 'stats_df' || word === 'results_df' || word === 'clean_data' || word === 'raw_data' || word === 'processed_data' || word === 'filtered_data' || word === 'merged_data' || word === 'grouped_data') {
                            // If DataFrame/data structures, make it cyan
                            result += `<span style="color: #56b6c2; font-weight: bold;">${word}</span>`;
                        }
                        else if (word === 'len' || word === 'str' || word === 'int' || word === 'float' || word === 'bool' || word === 'list' || word === 'dict' || word === 'tuple' || word === 'set' || word === 'type' || word === 'range' || word === 'enumerate' || word === 'zip' || word === 'map' || word === 'filter' || word === 'sorted' || word === 'reversed' || word === 'sum' || word === 'min' || word === 'max' || word === 'abs' || word === 'round' || word === 'pow' || word === 'divmod' || word === 'print' || word === 'input' || word === 'open' || word === 'file' || word === 'iter' || word === 'next' || word === 'all' || word === 'any' || word === 'bin' || word === 'hex' || word === 'oct' || word === 'ord' || word === 'chr' || word === 'ascii' || word === 'repr' || word === 'format' || word === 'eval' || word === 'exec' || word === 'compile' || word === 'callable' || word === 'isinstance' || word === 'issubclass' || word === 'hasattr' || word === 'getattr' || word === 'setattr' || word === 'delattr' || word === 'dir' || word === 'vars' || word === 'locals' || word === 'globals' || word === 'id' || word === 'hash' || word === 'object' || word === 'super' || word === 'property' || word === 'staticmethod' || word === 'classmethod' || word === 'slice' || word === 'memoryview' || word === 'bytearray' || word === 'bytes' || word === 'complex' || word === 'frozenset') {
                            // If built-in functions, make it yellow
                            result += `<span style="color: #e5c07b; font-weight: bold;">${word}</span>`;
                        }
                        else if (word === 'True' || word === 'False' || word === 'None' || word === 'self' || word === 'cls') {
                            // If built-in constants, make it orange
                            result += `<span style="color: #e06c75; font-weight: bold;">${word}</span>`;
                        }
                        else if (word.startsWith('&quot;') || word.startsWith('&#39;') || (word.startsWith('&quot;') && word.endsWith('&quot;')) || (word.startsWith('&#39;') && word.endsWith('&#39;'))) {
                            // If string, make it green
                            result += `<span style="color: #98c379;">${word}</span>`;
                        }
                        else if (/^\d+(\.\d+)?$/.test(word)) {
                            // If number, make it light blue
                            result += `<span style="color: #61afef; font-weight: bold;">${word}</span>`;
                        }
                        else if (word === '=' || word === '+' || word === '-' || word === '*' || word === '/' || word === '%' || word === '==' || word === '!=' || word === '&lt;' || word === '&gt;' || word === '&lt;=' || word === '&gt;=') {
                            // If operator, make it pink
                            result += `<span style="color: #ff79c6; font-weight: bold;">${word}</span>`;
                        }
                        else {
                            // Else, keep it white/default
                            result += word;
                        }
                    });
                }
                
                // Add line break except for last line
                if (lineIndex < lines.length - 1) {
                    result += '\n';
                }
            });
            
            return result;
        }

        function renderSection(section, index) {
            const sectionId = `section_${Date.now()}_${index}`;
            const codeBlocks = [];
            let content = section.content;
            
            // Extract and replace code blocks
            content = content.replace(/```(\w+)?\n([\s\S]*?)```/g, (match, language, code) => {
                const codeId = `code_${Date.now()}_${codeBlocks.length}`;
                codeBlocks.push({ id: codeId, language: language || 'python', code: code.trim() });
                return `__CODE_BLOCK_${codeBlocks.length - 1}__`;
            });

            // Process other markdown - escape HTML entities in regular content
            content = content
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\*(.*?)\*/g, '<em>$1</em>')
                .replace(/`(.*?)`/g, '<code style="background: rgba(0,102,204,0.1); padding: 2px 4px; border-radius: 3px;">$1</code>')
                .replace(/^\- (.+)$/gm, '<li>$1</li>')
                .replace(/\n\n/g, '</p><p>')
                .replace(/^(.+)$/gm, '<p>$1</p>');

            // Wrap lists
            content = content.replace(/(<li>.*<\/li>)/gs, '<ul>$1</ul>')
                .replace(/<\/p><p><ul>/g, '<ul>')
                .replace(/<\/ul><\/p><p>/g, '</ul>');

            // Replace code blocks with properly formatted HTML
            codeBlocks.forEach((block, idx) => {
                const formattedCode = formatCodeBlock(block.code, block.language);
                const codeHtml = `
                    <div class="code-section">
                        <div class="code-header">
                            <div class="code-title">
                                <span>💻</span>
                                ${block.language.toUpperCase()} Code
                            </div>
                            <button class="copy-btn" onclick="copyCode('${block.id}')">
                                <span>📋</span>
                                Copy Code
                            </button>
                        </div>
                        <div class="code-container">
                            <div class="code-content" id="${block.id}">${formattedCode}</div>
                        </div>
                    </div>
                `;
                content = content.replace(`__CODE_BLOCK_${idx}__`, codeHtml);
            });

            return `
                <div class="collapsible-section">
                    <button class="section-toggle collapsed" onclick="toggleSection(this)">
                        🔧 ${section.title}
                    </button>
                    <div class="section-content">
                        <div class="content-text">
                            ${content}
                        </div>
                    </div>
                </div>
            `;
        }

        // Initialize the page with dynamic configuration
        document.addEventListener('DOMContentLoaded', async function() {
            // Load tab configuration first
            await loadTabConfiguration();
            
            // Set navigation as collapsed by default
            var tabNav = document.getElementById("tabNavigation");
            var toggleBtn = document.getElementById("tabToggleBtn");
            
            if (tabNav && toggleBtn) {
                tabNav.classList.remove("expanded");
                toggleBtn.classList.add("collapsed");
            }
            
            // Initialize all content sections as collapsed by default
            var sections = document.querySelectorAll('.section-content');
            var buttons = document.querySelectorAll('.section-toggle');
            
            sections.forEach(function(section) {
                if (section) section.classList.remove('expanded');
            });
            
            buttons.forEach(function(button) {
                if (button) button.classList.add('collapsed');
            });

            // Apply syntax highlighting to ALL existing code content
            applyGlobalSyntaxHighlighting();
        });

        function applyGlobalSyntaxHighlighting() {
            // Apply if-else color highlighting to all code elements
            const allCodeElements = document.querySelectorAll('.code-content');
            
            allCodeElements.forEach(element => {
                // Only apply if not already colored
                if (!element.innerHTML.includes('style="color:')) {
                    const originalCode = element.textContent;
                    const coloredCode = formatCodeBlock(originalCode, 'python');
                    element.innerHTML = coloredCode;
                }
            });
        }

        // Enhanced function to apply highlighting to newly created code blocks
        function applySyntaxHighlightingToElement(element) {
            if (!element || element.querySelector('span')) return;
            
            const originalCode = element.textContent;
            const highlightedCode = formatCodeBlock(originalCode, 'python');
            element.innerHTML = highlightedCode;
        }
    </script>
</body>
</html>
